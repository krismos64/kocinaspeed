{% extends 'base.html.twig' %}

{% block title %}Les recettes
{% endblock %}

{% block body %}
	<div
		class="uk-container">
		<!-- Section avec une image de fond -->
		<div class="uk-border-rounded-large uk-background-top-center uk-background-cover uk-background-norepeat uk-light uk-inline uk-overflow-hidden uk-width-1-1" style="background-image: url('{{ asset('img/backgrounds/background5.jpg') }}');">
			<div class="uk-position-cover uk-header-overlay"></div>
			<div class="uk-position-relative" data-uk-grid>
				<div class="uk-width-1-2@m uk-flex uk-flex-middle">
					<div
						class="uk-padding-large uk-padding-remove-right">
						<!-- Titre pour la section -->
						<h1 class="uk-heading-small uk-margin-remove-top" style="font-family: 'Dancing Script', cursive; font-size: 3rem; color: #4e342e;">
							Toutes nos recettes
						</h1>
					</div>
				</div>
				<div class="uk-width-expand@m"></div>
			</div>
		</div>
	</div>

	<!-- Section affichant les recettes -->
	<div class="uk-section uk-section-default" style="background: linear-gradient(135deg, #f3e5f5, #e8f5e9);">
		<div class="uk-container">
			<div
				data-uk-grid>
				<!-- Colonne de gauche pour les catégories -->
				<div class="uk-width-1-4@m sticky-container">
					<div data-uk-sticky="offset: 100; bottom: true; media: @m;" class="uk-border-rounded uk-background-cover" style="background: linear-gradient(135deg, rgba(225, 190, 231, 0.8), rgba(200, 230, 201, 0.8)); padding: 15px; font-family: 'Poppins', sans-serif;">
						<h2 class="uk-text-bold uk-light">Nos recettes</h2>
						<ul class="uk-nav-default uk-nav-parent-icon uk-nav-filter uk-margin-medium-top" data-uk-nav>
							{% for cat, label in categories %}
								<li class="uk-parent">
									<a href="#" class="uk-light category-link" data-category="{{ cat }}">{{ label }}</a>
									<ul class="uk-nav-sub">
										{% set category_recipes = allRecipes|filter(recipe => recipe.category == cat) %}
										{% if category_recipes|length > 0 %}
											{% for recipe in category_recipes %}
												<li>
													<a href="{{ path('app_recipe_details', { slug: recipe.slug }) }}" class="uk-light">{{ recipe.name }}</a>
												</li>
											{% endfor %}
										{% else %}
											<li>
												<span class="uk-light">Aucune recette disponible</span>
											</li>
										{% endif %}
									</ul>
								</li>
							{% endfor %}
						</ul>
					</div>
				</div>

				<!-- Colonne de droite pour la liste des recettes -->
				<div
					class="uk-width-expand@m">
					<!-- Barre de recherche avec un dégradé subtil -->
					<div class="uk-width-expand@m uk-margin-bottom">
						<form class="uk-search uk-search-default uk-width-1-1" action="{{ path('app_recipe_search') }}" method="get" style="background: linear-gradient(135deg, #f3e5f5, #e8f5e9); border-radius: 10px; font-family: 'Poppins', sans-serif;">
							<span data-uk-search-icon></span>
							<input class="uk-search-input uk-text-small uk-border-rounded uk-form-large" type="search" placeholder="Recherche par nom de recette..." name="query" style="background: transparent; border: none; color: #4e342e;">
						</form>
					</div>

					<!-- Bouton burger pour le menu déroulant des catégories en mode mobile -->
					<div class="uk-hidden@s uk-margin-bottom">
						<button class="uk-button uk-button-default" type="button" style="font-family: 'Poppins', sans-serif; background: #ff7043; color: white;">
							Catégories
							{% if category != 'all' %}:
								{{ categories[category] }}
							{% endif %}
						</button>
						<div class="uk-width-1-1" uk-dropdown="mode: click; boundary: !.uk-container">
							<ul class="uk-nav uk-dropdown-nav">
								<li>
									<a href="{{ path('app_recipe_index', {'category': 'all'}) }}" class="{% if category == 'all' %}uk-active{% endif %}">Toutes</a>
								</li>
								{% for cat, label in categories %}
									<li>
										<a href="{{ path('app_recipe_index', {'category': cat}) }}" class="{% if category == cat %}uk-active{% endif %}">
											{{ label }}
										</a>
									</li>
								{% endfor %}
							</ul>
						</div>
					</div>

					<!-- Boutons de filtres pour les écrans plus grands -->
					<div class="uk-visible@s uk-margin-medium-bottom uk-flex uk-flex-wrap uk-child-width-auto@s uk-grid-small" uk-grid>
						<div>
							<a href="{{ path('app_recipe_index', {'category': 'all'}) }}" class="uk-button uk-button-default {% if category == 'all' %}uk-button-primary{% endif %}" style="font-family: 'Poppins', sans-serif;">
								Toutes
							</a>
						</div>
						{% for cat, label in categories %}
							<div>
								<a href="{{ path('app_recipe_index', {'category': cat}) }}" class="uk-button uk-button-default {% if category == cat %}uk-button-primary{% endif %}" style="font-family: 'Poppins', sans-serif;">
									{{ label }}
								</a>
							</div>
						{% endfor %}
					</div>

					<!-- Liste des recettes avec design amélioré -->
					<div class="uk-child-width-1-1 uk-child-width-1-2@s uk-child-width-1-3@l uk-grid-match" data-uk-grid>
						{% for recipe in pager %}
							<div class="recipe-item" data-category="{{ recipe.category }}">
								<div class="uk-card uk-card-hover uk-border-rounded-large uk-overflow-hidden uk-box-shadow-large" 
									 style="background: linear-gradient(135deg, #ffffff, #f8f9fa); transition: all 0.3s ease; border: 1px solid rgba(255, 112, 67, 0.1);">
									
									<!-- Image de la recette - Plus grande et plus attractive -->
									<div class="uk-card-media-top uk-cover-container uk-overflow-hidden" style="height: 280px; position: relative;">
										{% if recipe.images|length > 0 %}
											<img class="lazy-load" 
												 src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='280'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3C/svg%3E"
												 data-src="{{ asset('uploads/recipes/' ~ recipe.images|first.imagePath) }}" 
												 alt="{{ recipe.name }}" 
												 loading="lazy"
												 style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
										{% else %}
											<img class="lazy-load" 
												 src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='280'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3C/svg%3E"
												 data-src="{{ asset('img/default-image.jpg') }}" 
												 alt="{{ recipe.name }}" 
												 loading="lazy"
												 style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
										{% endif %}
										
										<!-- Overlay avec catégorie -->
										<div class="uk-position-top-right uk-margin-small-top uk-margin-small-right">
											<span class="uk-badge uk-text-uppercase" 
												  style="background: linear-gradient(135deg, #ff7043, #ff5722); color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
												{{ categories[recipe.category] ?? recipe.category }}
											</span>
										</div>
										
										<!-- Overlay gradient pour le texte -->
										<div class="uk-position-bottom uk-background-gradient" style="background: linear-gradient(transparent, rgba(0,0,0,0.3)); height: 60px;"></div>
									</div>
									
									<!-- Contenu de la card -->
									<div class="uk-card-body uk-padding" style="padding: 20px;">
										<h3 class="uk-card-title uk-margin-remove-bottom uk-text-truncate" 
											style="font-family: 'Poppins', sans-serif; color: #2c3e50; font-size: 1.1rem; font-weight: 600; line-height: 1.3;">
											{{ recipe.name }}
										</h3>
										
										{% if recipe.description %}
											<p class="uk-text-small uk-text-muted uk-margin-small-top uk-margin-remove-bottom" 
											   style="line-height: 1.4; max-height: 2.8em; overflow: hidden; color: #6c757d;">
												{{ recipe.description|striptags|slice(0, 80) }}{{ recipe.description|striptags|length > 80 ? '...' : '' }}
											</p>
										{% endif %}
										
										<!-- Informations supplémentaires -->
										<div class="uk-margin-small-top uk-flex uk-flex-between uk-flex-middle">
											{% if recipe.cookingTime %}
												<div class="uk-flex uk-flex-middle">
													<span uk-icon="icon: clock; ratio: 0.8" style="color: #ff7043;"></span>
													<span class="uk-text-small uk-margin-small-left" style="color: #6c757d; font-weight: 500;">
														{{ recipe.cookingTime }} min
													</span>
												</div>
											{% endif %}
											
											{% if recipe.rating %}
												<div class="uk-flex uk-flex-middle">
													<span uk-icon="icon: star; ratio: 0.8" style="color: #ffc107;"></span>
													<span class="uk-text-small uk-margin-small-left" style="color: #6c757d; font-weight: 500;">
														{{ recipe.rating|number_format(1) }}
													</span>
												</div>
											{% endif %}
										</div>
									</div>
									
									<!-- Lien invisible pour toute la card -->
									<a href="{{ path('app_recipe_details', { slug: recipe.slug }) }}" class="uk-position-cover" aria-label="Voir la recette {{ recipe.name }}"></a>
								</div>
							</div>
						{% else %}
							<div class="uk-width-1-1">
								<p class="uk-text-center" style="font-family: 'Roboto', sans-serif; color: #4e342e;">Aucune recette disponible dans cette catégorie.</p>
							</div>
						{% endfor %}
					</div>

					<!-- Pagination -->
					{% if pager.haveToPaginate %}
						<ul class="uk-pagination uk-flex-center uk-margin-large-top">
							{% if pager.hasPreviousPage %}
								<li>
									<a href="{{ path('app_recipe_index', { category: category, page: pager.previousPage }) }}">&laquo; Précédent</a>
								</li>
							{% endif %}

							{% for page in 1..pager.nbPages %}
								<li {% if page == pager.currentPage %} class="uk-active" {% endif %}>
									<a href="{{ path('app_recipe_index', { category: category, page: page }) }}">{{ page }}</a>
								</li>
							{% endfor %}

							{% if pager.hasNextPage %}
								<li>
									<a href="{{ path('app_recipe_index', { category: category, page: pager.nextPage }) }}">Suivant &raquo;</a>
								</li>
							{% endif %}
						</ul>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block stylesheets %}
<style>
/* Effets hover pour les cards */
.uk-card-hover:hover {
    transform: translateY(-5px) !important;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15) !important;
}

.uk-card-hover:hover img {
    transform: scale(1.05) !important;
}

/* Animation des badges */
.uk-badge {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* Lazy loading effect */
.lazy-load {
    transition: opacity 0.3s ease;
    opacity: 0;
}

.lazy-load.loaded {
    opacity: 1;
}
</style>
{% endblock %}

{% block javascripts %}
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			// Category filtering
			var categoryLinks = document.querySelectorAll('.category-link');

			categoryLinks.forEach(function (link) {
				link.addEventListener('click', function (event) {
					event.preventDefault();

					// Fetch the category
					var category = this.getAttribute('data-category');

					// Scroll to the recipe list without jumping to the top
					document.getElementById('recipe-list').scrollIntoView({behavior: 'smooth', block: 'start'});
				});
			});

			// Lazy loading for images
			var lazyImages = document.querySelectorAll('.lazy-load');
			var imageObserver = new IntersectionObserver(function(entries, observer) {
				entries.forEach(function(entry) {
					if (entry.isIntersecting) {
						var img = entry.target;
						img.src = img.dataset.src;
						img.classList.add('loaded');
						imageObserver.unobserve(img);
					}
				});
			});

			lazyImages.forEach(function(img) {
				imageObserver.observe(img);
			});
		});
	</script>
{% endblock %}
